{% extends 'base.html' %}
{% block title %}Edit Product{% endblock %}
{% block content %}
<div class="container">
    <h2>Edit Product</h2>
    <form method="post" enctype="multipart/form-data">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div>
            <label>Name</label>
            <input type="text" name="name" value="{{ product.name }}" required>
        </div>
        <div>
            <label>Description</label>
            <textarea name="description">{{ product.description }}</textarea>
        </div>
        <div>
            <label>Price</label>
            <input type="number" name="price" step="0.01" value="{{ product.price }}" required>
        </div>
        <div>
            <label>Category</label>
            <select name="category_id" required>
                {% for category in categories %}
                <option value="{{ category.id }}" {% if product.category_id==category.id %}selected{% endif %}>{{
                    category.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label>Add More Images</label>
            <input type="file" name="images" multiple accept="image/*">
            <small>You can upload additional images.</small>
        </div>
        <button type="submit">Save Changes</button>
    </form>
    <div style="margin-top:2rem;">
        <h3>Current Images</h3>
        <ul style="list-style:none; padding:0;">
            {% for img in product.images %}
            <li style="display:inline-block; margin:0.5rem;">
                <img src="{{ img.image_url }}" alt="Product Image" width="100" style="display:block;">
                <form method="post" action="{{ url_for('farmer.delete_product_image', image_id=img.id) }}">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit"
                        style="background:#e53e3e;color:#fff;border:none;padding:0.2rem 0.6rem;border-radius:5px;margin-top:0.3rem;"
                        onclick="return confirm('Delete this image?')">Delete</button>
                </form>
            </li>
            {% endfor %}
        </ul>
    </div>
    <div style="margin-top:2rem;">
        <h3>Price Change History</h3>
        {% if price_history %}
        <table style="width:100%;border-collapse:collapse;">
            <thead>
                <tr>
                    <th style="text-align:left;">Price</th>
                    <th style="text-align:left;">Changed At</th>
                </tr>
            </thead>
            <tbody>
                {% for entry in price_history %}
                <tr>
                    <td>{{ entry.price }}</td>
                    <td>{{ entry.changed_at.strftime('%Y-%m-%d %H:%M') }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p>No price changes recorded.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
